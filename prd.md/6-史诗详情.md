# 6. 史诗详情

## 史诗 1: 项目基础与用户核心体验
**扩展目标**: 此史诗的目标是为 LingoLeap 应用奠定坚实的技术基础，并交付最核心的用户身份验证流程。完成此史诗后，我们将拥有一个可部署的应用程序框架，用户将能够创建账户、登录、注销，并访问一个受保护的个人页面，为后续学习功能的开发做好准备。

### Story 1.1: 项目初始化与设置
* **As a** 开发者,
* **I want** to set up the monorepo project structure with a Next.js frontend and link it to a Supabase backend,
* **so that** we have a clean, version-controlled, and deployable starting point for development.
**验收标准**:
1.  在 GitHub 上创建一个新的 monorepo 代码仓库。
2.  在 Supabase 上创建一个新的项目，并获取 API 密钥。
3.  在本地初始化一个 Next.js + TypeScript + Chakra UI 项目。
4.  项目结构符合我们之前在技术假设中定义的模式。
5.  应用可以成功在本地运行 (`npm run dev`)。
6.  项目与 Vercel 成功关联，并且可以部署一个简单的 "Hello World" 页面。

### Story 1.2: 用户注册
* **As a** 新访客,
* **I want** to create a new account using my email and a password,
* **so that** I can access the application's features.
**验收标准**:
1.  存在一个带有电子邮件和密码输入字段的注册页面 (`/signup`)。
2.  点击“注册”按钮后，表单数据会提交给 Supabase Auth 进行处理。
3.  注册成功后，一个新用户会出现在 Supabase 的 `auth.users` 表中。
4.  注册成功后，用户会被重定向到仪表盘页面 (`/dashboard`)。
5.  如果注册失败（例如，电子邮件已被使用），会向用户显示一条清晰的错误消息。

### Story 1.3: 用户登录与会话管理
* **As a** 注册用户,
* **I want** to log in to the application using my email and password,
* **so that** I can access my personal dashboard and learning progress.
**验收标准**:
1.  存在一个带有电子邮件和密码输入字段的登录页面 (`/login`)。
2.  用户可以使用有效的凭据成功登录。
3.  登录成功后，应用会建立一个持久的用户会话（由 Supabase client 管理）。
4.  登录成功后，用户会被重定向到仪表盘页面 (`/dashboard`)。
5.  使用无效凭据登录时，会向用户显示一条清晰的错误消息。

### Story 1.4: 受保护的仪表盘页面与登出
* **As a** 登录用户,
* **I want** to access a personal dashboard page that is protected from public access and be able to log out,
* **so that** my information is secure and I can end my session.
**验收标准**:
1.  仪表盘页面 (`/dashboard`) 只有在用户登录后才能访问。
2.  未登录的用户尝试访问 `/dashboard` 时，会被重定向到登录页面。
3.  仪表盘页面上显示一条欢迎信息，包含用户的电子邮件地址。
4.  页面上有一个“登出”按钮。
5.  点击“登出”按钮后，用户的会话被终止，并被重定向到登录页面。

### Story 1.5: 基础 UI 布局
* **As a** 用户,
* **I want** to see a consistent and clean layout across all pages,
* **so that** I have a predictable and pleasant user experience.
**验收标准**:
1.  使用 Chakra UI 创建一个可重用的主布局组件（例如 `MainLayout`）。
2.  该布局包含一个简单的页头（Header）和一个用于显示页面内容的主区域。
3.  登录、注册和仪表盘页面都使用这个主布局组件。
4.  布局在移动设备和桌面设备上都能正确显示。

## 史诗 2: 核心学习循环
**扩展目标**: 此史诗的目标是构建 LingoLeap 的核心价值主张：一个完整的“学习-测试”闭环。完成此史诗后，登录的用户将能够选择一个单词集进行学习，通过交互式卡片掌握新单词，并通过练习测试来检验他们的学习成果，从而获得完整的核心学习体验。

### Story 2.1: 单词与卡片集数据模型
* **As a** 开发者,
* **I want** to define and create the database schema for "Word Decks" and "Words" in Supabase,
* **so that** we have a structured way to store and manage the application's learning content.
**验收标准**:
1.  在 Supabase 数据库中创建名为 `decks` 的新表，至少包含 `id`, `title`, `description` 和 `language` 字段。
2.  创建名为 `words` 的新表，至少包含 `id`, `deck_id` (外键关联到 `decks`), `original_word`, `translation` 和 `example_sentence` 字段。
3.  两个表都已开启行级安全策略 (Row Level Security)，以确保用户只能访问授权内容。
4.  表中已填充至少 2 个示例卡片集，每个卡片集包含 5 个示例单词，用于开发和测试。

### Story 2.2: 展示单词卡片集
* **As a** 登录用户,
* **I want** to see a list of available word decks on my dashboard,
* **so that** I can choose what I want to learn next.
**验收标准**:
1.  仪表盘页面 (`/dashboard`) 从 Supabase 数据库中获取并显示一个可用的单词卡片集列表。
2.  列表中的每一项都清晰地展示了卡片集的标题和描述。
3.  当没有可用的卡片集时，会显示一个友好的提示信息。
4.  列表中的每个卡片集都是可点击的，并准备好链接到学习页面。

### Story 2.3: 单词学习（抽认卡视图）
* **As a** 登录用户,
* **I want** to be able to study the words from a selected deck using a flashcard interface,
* **so that** I can effectively learn and memorize new vocabulary.
**验收标准**:
1.  点击仪表盘上的一个卡片集，会导航到一个新的学习页面（例如 `/learn/[deckId]`)。
2.  该页面一次展示卡片集中的一个单词（正面为原词，反面为翻译和例句）。
3.  用户可以通过点击或轻扫卡片来“翻转”它，以查看答案。
4.  页面上有“下一个”和“上一个”按钮，允许用户在卡片集中的所有单词之间导航。
5.  页面标题清晰地指明了当前正在学习的卡片集名称。

### Story 2.4: 练习测试（问答视图）
* **As a** 登录用户,
* **I want** to start a quiz based on a word deck I have studied,
* **so that** I can test my knowledge and recall.
**验收标准**:
1.  在学习页面或卡片集详情页上有一个“开始测试”的按钮。
2.  点击后，用户会进入一个新的测试页面（例如 `/quiz/[deckId]`)。
3.  测试会从卡片集中随机抽取单词，并生成选择题（例如，一个原词和四个翻译选项）。
4.  用户可以为每个问题选择一个答案。
5.  在所有问题回答完毕之前，用户不能提交测试。

### Story 2.5: 测试提交与结果反馈
* **As a** 登录用户,
* **I want** to submit my quiz and see my results immediately,
* **so that** I can get feedback on my performance and know what I need to improve.
**验收标准**:
1.  回答完所有问题后，“提交”按钮变为可用状态。
2.  提交测试后，系统会计算用户的得分（例如，正确率百分比）。
3.  导航到一个结果页面，清晰地显示用户的最终得分。
4.  结果页面还会展示一个简单的回顾，列出用户答错的问题和正确答案。

## 史诗 3: 学习进度追踪与激励
**扩展目标**: 此史诗的目标是让用户的学习成果变得可见且富有激励性，从而提升长期学习动力和用户粘性。完成此史诗后，用户将能够在他们的仪表盘上看到详细的学习统计数据，并通过一个简单的连续学习记录（streak）机制获得激励。

### Story 3.1: 记录测试结果与单词掌握度
* **As a** 开发者,
* **I want** to save the user's quiz results and update their mastery of individual words in the database,
* **so that** we can accurately track their learning progress over time.
**验收标准**:
1.  在 Supabase 中创建一个新的 `quiz_results` 表，用于存储每次测试的 `user_id`, `deck_id`, `score`, 和 `completed_at` 时间戳。
2.  创建一个 `user_word_mastery` 表，用于追踪每个用户对每个单词的掌握程度（例如，一个从0到5的等级）。
3.  当用户提交测试（来自 Story 2.5）后，一条新的记录会保存到 `quiz_results` 表中。
4.  根据用户在测试中对每个单词的回答（正确或错误），`user_word_mastery` 表中对应的数据会被更新。

### Story 3.2: 在仪表盘上展示学习统计
* **As a** 登录用户,
* **I want** to see my detailed learning statistics on my dashboard,
* **so that** I can understand my progress and feel a sense of accomplishment.
**验收标准**:
1.  仪表盘页面 (`/dashboard`) 现在会从数据库获取并展示用户的学习统计数据。
2.  仪表盘上会显示一个“已掌握单词总数”的统计指标。
3.  仪表盘上会显示一个“历史平均测试成绩”的统计指标。
4.  仪表盘上新增一个“最近活动”区域，显示用户最近完成的 3 次测试及其分数。

### Story 3.3: 引入连续学习记录 (Streak)
* **As a** 登录用户,
* **I want** to see my continuous learning streak,
* **so that** I am motivated to come back and learn every day.
**验收标准**:
1.  系统会追踪用户连续完成学习活动（学习一个卡片集或完成一次测试）的天数。
2.  用户的当前连续学习天数会醒目地显示在仪表盘上（例如，“🔥 5 天”）。
3.  如果用户某一天没有完成任何学习活动，他们的连续学习记录将在第二天重置为 0。
4.  完成当天的首次学习活动后，连续学习记录会正确地增加 1。