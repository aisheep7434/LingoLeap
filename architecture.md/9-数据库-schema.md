# 9. 数据库 Schema

```sql
-- Profiles Table
CREATE TABLE public.profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  updated_at TIMESTAMPTZ,
  username TEXT UNIQUE,
  full_name TEXT,
  avatar_url TEXT,
  learning_streak INT DEFAULT 0,
  CONSTRAINT username_length CHECK (char_length(username) >= 3)
);

-- Decks Table
CREATE TABLE public.decks (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  title TEXT NOT NULL,
  description TEXT,
  language VARCHAR(10) NOT NULL
);
CREATE INDEX idx_decks_language ON public.decks(language);

-- Words Table
CREATE TABLE public.words (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  deck_id BIGINT NOT NULL REFERENCES public.decks(id) ON DELETE CASCADE,
  original_word TEXT NOT NULL,
  translation TEXT NOT NULL,
  example_sentence TEXT
);
CREATE INDEX idx_words_deck_id ON public.words(deck_id);

-- Quiz Results Table
CREATE TABLE public.quiz_results (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  user_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,
  deck_id BIGINT NOT NULL REFERENCES public.decks(id) ON DELETE CASCADE,
  score INT NOT NULL CHECK (score >= 0 AND score <= 100)
);
CREATE INDEX idx_quiz_results_user_id ON public.quiz_results(user_id);

-- User Word Mastery Table
CREATE TABLE public.user_word_mastery (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,
  word_id BIGINT NOT NULL REFERENCES public.words(id) ON DELETE CASCADE,
  mastery_level INT NOT NULL DEFAULT 0,
  last_reviewed_at TIMESTAMPTZ,
  UNIQUE (user_id, word_id)
);
CREATE INDEX idx_user_word_mastery_user_id_word_id ON public.user_word_mastery(user_id, word_id);
```
